<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate API Frontend - Ø¹Ø§Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'whatsapp': '#25D366',
                        'whatsapp-dark': '#075E54',
                        'api': '#3b82f6'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            font-size: 16px; /* Increased base font size */
        }
        
        .rtl-text {
            direction: rtl;
            text-align: right;
        }
        
        .ltr-text {
            direction: ltr;
            text-align: left;
        }
        
        .search-highlight {
            background-color: #fef08a;
            font-weight: 600;
        }
        
        .table-row:hover {
            background-color: #f0fdf4;
        }
        
        .status-badge {
            font-size: 0.875rem; /* Increased from 0.75rem */
            padding: 0.375rem 0.625rem; /* Increased padding */
            border-radius: 0.375rem;
            margin: 0.125rem;
            display: inline-block;
        }
        
        .property-land { background-color: #dcfce7; color: #16a34a; }
        .property-apartment { background-color: #dbeafe; color: #2563eb; }
        .property-villa { background-color: #fef3c7; color: #d97706; }
        .property-commercial { background-color: #f3e8ff; color: #9333ea; }
        
        .phone-number {
            font-family: 'Courier New', monospace;
            background-color: #f1f5f9;
            padding: 0.25rem 0.375rem; /* Increased padding */
            border-radius: 0.25rem;
            font-size: 0.875rem; /* Increased from 0.75rem */
        }
        
        .api-status {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 18px; /* Increased padding */
            border-radius: 8px;
            color: white;
            font-size: 14px; /* Increased from 12px */
            z-index: 1000;
        }
        
        .api-connected { background-color: #10b981; }
        .api-disconnected { background-color: #ef4444; }
        .api-loading { background-color: #f59e0b; }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            direction: rtl;
        }
        
        .modal-content.max-w-2xl {
            max-width: 672px;
        }
        
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- API Status Indicator -->
    <div id="api-status" class="api-status api-loading">
        <div class="flex items-center">
            <div class="animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-2"></div>
            <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API...</span>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-api text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="text-left">
                    <div class="text-lg font-semibold" id="total-records">0</div>
                    <div class="text-sm text-blue-200">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
                    <div class="text-xs text-blue-300 mt-1">
                        <span id="api-url">API: http://localhost:8000</span>
                    </div>
                </div>
                <div class="flex items-center space-x-reverse space-x-4">
                    <div class="bg-white/20 p-3 rounded-lg">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Ø¹Ø§Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª - API Frontend</h1>
                        <p class="text-blue-200">ÙˆØ§Ø¬Ù‡Ø© Ù…ØªØµÙ„Ø© Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª SQLite Ø¹Ø¨Ø± Flask API</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Statistics Bar -->
    <div class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4 py-4">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div class="text-center">
                    <div class="text-xl font-bold text-green-600" id="stats-senders">0</div>
                    <div class="text-sm text-gray-600">Ù…Ø±Ø³Ù„ÙŠÙ† ÙØ±ÙŠØ¯ÙŠÙ†</div>
                </div>
                <div class="text-center">
                    <div class="text-xl font-bold text-blue-600" id="stats-regions">0</div>
                    <div class="text-sm text-gray-600">Ù…Ù†Ø§Ø·Ù‚</div>
                </div>
                <div class="text-center">
                    <div class="text-xl font-bold text-purple-600" id="stats-types">0</div>
                    <div class="text-sm text-gray-600">Ø£Ù†ÙˆØ§Ø¹ Ø¹Ù‚Ø§Ø±Ø§Øª</div>
                </div>
                <div class="text-center">
                    <div class="text-xl font-bold text-yellow-600" id="stats-with-phone">0</div>
                    <div class="text-sm text-gray-600">Ø¨Ø£Ø±Ù‚Ø§Ù… Ù‡ÙˆØ§ØªÙ</div>
                </div>
                <div class="text-center">
                    <div class="text-xl font-bold text-red-600" id="stats-with-region">0</div>
                    <div class="text-sm text-gray-600">Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="container mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù…Ø±Ø´Ø­Ø§Øª</h3>
                <div class="flex space-x-reverse space-x-2">
                    <button onclick="testAPI()" class="px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600">
                        Ø§Ø®ØªØ¨Ø§Ø± API
                    </button>
                    <button onclick="loadStats()" class="px-3 py-1 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600">
                        ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    </button>
                    <button onclick="clearAllFilters()" class="px-3 py-1 bg-gray-500 text-white rounded-md text-sm hover:bg-gray-600">
                        Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¨Ø­Ø«</label>
                    <input type="text" id="search-query" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„..." 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-api">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
                    <select id="property-type-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-api">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                        <option value="land">Ø£Ø±Ø¶</option>
                        <option value="apartment">Ø´Ù‚Ø©</option>
                        <option value="villa">ÙÙŠÙ„Ø§</option>
                        <option value="commercial">ØªØ¬Ø§Ø±ÙŠ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                    <input type="text" id="region-filter" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©..." 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-api">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ø±Ø³Ù„</label>
                    <input type="text" id="sender-filter" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„..." 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-api">
                </div>
            </div>
            
            <div class="mt-4 flex items-center justify-between">
                <div class="flex items-center space-x-reverse space-x-4">
                    <button onclick="searchProperties()" class="px-4 py-2 bg-api text-white rounded-md hover:bg-blue-700">
                        Ø¨Ø­Ø«
                    </button>
                    <button onclick="loadAllProperties()" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                        Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                    </button>
                </div>
                <div class="flex items-center space-x-reverse space-x-2 text-sm text-gray-600">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</label>
                    <select id="limit-select" class="px-2 py-1 border border-gray-300 rounded">
                        <option value="20">20</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                        <option value="200">200</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <h3 class="text-md font-semibold mb-3">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
            <div class="flex flex-wrap gap-2">
                <button onclick="showAddPropertyModal()" class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">
                    â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯
                </button>
                <button onclick="removeDuplicates()" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">
                    ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±
                </button>
                <button onclick="loadTopRegions()" class="px-3 py-1 bg-yellow-500 text-white rounded text-sm hover:bg-yellow-600">
                    ğŸ“ Ø£Ù‡Ù… Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
                </button>
                <button onclick="loadTopSenders()" class="px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600">
                    ğŸ‘¥ Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø±Ø³Ù„ÙŠÙ† Ù†Ø´Ø§Ø·Ø§Ù‹
                </button>
                <button onclick="loadPropertyTypes()" class="px-3 py-1 bg-indigo-500 text-white rounded text-sm hover:bg-indigo-600">
                    ğŸ  ØªÙˆØ²ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
                </button>
                <button onclick="searchByKeyword('Ù„Ù„Ø¨ÙŠØ¹')" class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">
                    ğŸ’° Ø¹Ù‚Ø§Ø±Ø§Øª Ù„Ù„Ø¨ÙŠØ¹
                </button>
                <button onclick="searchByKeyword('Ø´Ù‚Ø©')" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
                    ğŸ¢ Ø§Ù„Ø´Ù‚Ù‚
                </button>
                <button onclick="searchByKeyword('ÙÙŠÙ„Ø§')" class="px-3 py-1 bg-orange-500 text-white rounded text-sm hover:bg-orange-600">
                    ğŸ˜ï¸ Ø§Ù„ÙÙŠÙ„Ø§Øª
                </button>
            </div>
        </div>

        <!-- Results Container -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="p-4 bg-gray-50 border-b">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
                    <div id="results-info" class="text-sm text-gray-600">
                        Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="overflow-x-auto">
                <table class="w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ù…Ø¹Ø±Ù</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ù…Ø±Ø³Ù„</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Enhanced Pagination -->
            <div class="bg-white px-6 py-4 flex items-center justify-between border-t border-gray-200">
                <div class="flex items-center">
                    <span class="text-base text-gray-700" id="pagination-info">
                        Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                    </span>
                </div>
                <div class="flex items-center space-x-reverse space-x-3">
                    <div class="flex items-center space-x-reverse space-x-2">
                        <label for="page-size" class="text-sm text-gray-600 ml-2">Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø©:</label>
                        <select id="page-size" onchange="changePageSize()" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500">
                            <option value="20">20</option>
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-reverse space-x-1">
                        <button onclick="firstPage()" id="first-btn" 
                                class="px-3 py-2 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed">
                            Ø§Ù„Ø£ÙˆÙ„
                        </button>
                        <button onclick="previousPage()" id="prev-btn" 
                                class="px-4 py-2 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                            Ø§Ù„Ø³Ø§Ø¨Ù‚
                        </button>
                        <span id="page-numbers" class="px-4 py-2 text-sm font-medium text-gray-700">
                            ØµÙØ­Ø© 1
                        </span>
                        <button onclick="nextPage()" id="next-btn" 
                                class="px-4 py-2 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                            Ø§Ù„ØªØ§Ù„ÙŠ
                        </button>
                        <button onclick="lastPage()" id="last-btn" 
                                class="px-3 py-2 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed">
                            Ø§Ù„Ø£Ø®ÙŠØ±
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Property Details Modal -->
    <div id="propertyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePropertyModal()">&times;</span>
            <h2 class="text-xl font-bold mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±</h2>
            <div id="propertyDetails"></div>
        </div>
    </div>

    <!-- Add/Edit Property Modal -->
    <div id="addEditModal" class="modal">
        <div class="modal-content max-w-2xl">
            <span class="close" onclick="closeAddEditModal()">&times;</span>
            <h2 id="addEditTitle" class="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯</h2>
            <form id="propertyForm" class="space-y-4">
                <input type="hidden" id="propertyId" name="unique_id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„ *</label>
                        <input type="text" id="senderName" name="sender_name" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                        <input type="text" id="region" name="region"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
                        <select id="propertyType" name="property_type"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                            <option value="Ø´Ù‚Ø©">Ø´Ù‚Ø©</option>
                            <option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
                            <option value="Ø£Ø±Ø¶">Ø£Ø±Ø¶</option>
                            <option value="ØªØ¬Ø§Ø±ÙŠ">ØªØ¬Ø§Ø±ÙŠ</option>
                            <option value="Ù…ÙƒØªØ¨">Ù…ÙƒØªØ¨</option>
                            <option value="Ø§Ø³ØªÙˆØ¯ÙŠÙˆ">Ø§Ø³ØªÙˆØ¯ÙŠÙˆ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="date" name="date"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ÙˆÙ‚Øª</label>
                        <input type="time" id="time" name="time"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø±Ø³Ø§Ù„Ø© *</label>
                    <textarea id="message" name="message" rows="4" required
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±..."></textarea>
                </div>
                
                <div class="flex justify-end space-x-reverse space-x-3 pt-4">
                    <button type="button" onclick="closeAddEditModal()" 
                            class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
                        Ø­ÙØ¸
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="api-status" class="api-status api-loading">
        <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:8000';
        
        // State management
        let currentOffset = 0;
        let currentLimit = 50;
        let currentData = [];
        let hasMore = false;
        
        // Check API connection on load
        async function checkApiConnection() {
            try {
                updateApiStatus('loading', 'Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...');
                
                // First check health endpoint
                const healthResponse = await fetch(`${API_BASE_URL}/health`);
                if (healthResponse.ok) {
                    const health = await healthResponse.json();
                    console.log('Health check:', health);
                    
                    if (health.status === 'healthy') {
                        updateApiStatus('connected', 'Ù…ØªØµÙ„ Ø¨Ù€ API ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                        loadStats();
                        loadAllProperties();
                    } else {
                        updateApiStatus('disconnected', `Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${health.database}`);
                    }
                } else {
                    // Fallback to basic API check
                    const response = await fetch(`${API_BASE_URL}/`);
                    if (response.ok) {
                        updateApiStatus('connected', 'Ù…ØªØµÙ„ Ø¨Ù€ API');
                        loadStats();
                        loadAllProperties();
                    } else {
                        throw new Error('API not responding');
                    }
                }
            } catch (error) {
                updateApiStatus('disconnected', `ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API - ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 8000`);
                console.error('API connection failed:', error);
            }
        }
        
        function updateApiStatus(status, message) {
            const statusEl = document.getElementById('api-status');
            statusEl.className = `api-status api-${status}`;
            statusEl.innerHTML = `<span>${message}</span>`;
            
            if (status === 'connected') {
                setTimeout(() => statusEl.style.display = 'none', 3000);
            }
        }
        
        // Load database statistics
        async function loadStats() {
            try {
                updateApiStatus('loading', 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
                const response = await fetch(`${API_BASE_URL}/api/stats`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result && result.error) {
                    throw new Error(result.error);
                }
                
                if (result && result.total_properties !== undefined) {
                    document.getElementById('total-records').textContent = result.total_properties.toLocaleString();
                    document.getElementById('stats-senders').textContent = result.unique_senders.toLocaleString();
                    document.getElementById('stats-regions').textContent = result.unique_regions.toLocaleString();
                    document.getElementById('stats-types').textContent = result.unique_property_types.toLocaleString();
                    
                    updateApiStatus('connected', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
                } else {
                    updateApiStatus('disconnected', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            } catch (error) {
                updateApiStatus('disconnected', `Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${error.message}`);
                console.error('Error loading stats:', error);
            }
        }
        
        // Load all properties
        async function loadAllProperties() {
            const propertyType = document.getElementById('property-type-filter').value;
            const region = document.getElementById('region-filter').value;
            const sender = document.getElementById('sender-filter').value;
            
            let url = `${API_BASE_URL}/api/properties?limit=${currentLimit}&page=${currentPage}`;
            
            if (propertyType) url += `&property_type=${encodeURIComponent(propertyType)}`;
            if (region) url += `&region=${encodeURIComponent(region)}`;
            if (sender) url += `&sender=${encodeURIComponent(sender)}`;
            
            try {
                updateApiStatus('loading', 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                console.log('Fetching from URL:', url);
                const response = await fetch(url);
                const result = await response.json();
                
                console.log('API Response:', result);
                
                if (result && result.data) {
                    currentData = result.data;
                    totalProperties = result.pagination?.total || result.data.length;
                    
                    displayProperties(result.data);
                    updatePaginationInfo(result.data);
                    updateApiStatus('connected', `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${result.data.length} Ø¹Ù‚Ø§Ø±`);
                } else {
                    console.error('No data in response:', result);
                    updateApiStatus('disconnected', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª');
                    displayProperties([]); // Show empty state
                }
            } catch (error) {
                updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                console.error('Error loading properties:', error);
                displayProperties([]); // Show empty state
            }
        }
        
        // Test API connection and data loading
        async function testAPI() {
            try {
                console.log('Testing API connection...');
                updateApiStatus('loading', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...');
                
                // Test stats endpoint
                const statsResponse = await fetch(`${API_BASE_URL}/api/stats`);
                const statsData = await statsResponse.json();
                console.log('Stats data:', statsData);
                
                // Test properties endpoint
                const propsResponse = await fetch(`${API_BASE_URL}/api/properties?limit=3`);
                const propsData = await propsResponse.json();
                console.log('Properties data:', propsData);
                
                // Update display with test data
                if (statsData) {
                    document.getElementById('total-records').textContent = statsData.total_properties.toLocaleString();
                }
                
                if (propsData && propsData.data) {
                    displayProperties(propsData.data);
                    updateApiStatus('connected', `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${propsData.data.length} Ø¹Ù‚Ø§Ø± Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±`);
                } else {
                    updateApiStatus('disconnected', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
            } catch (error) {
                updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
                console.error('Test API error:', error);
            }
        }
        
        // Test API connection and data loading
        async function testAPI() {
            try {
                console.log('Testing API connection...');
                updateApiStatus('loading', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...');
                
                // Test stats endpoint
                const statsResponse = await fetch(`${API_BASE_URL}/api/stats`);
                const statsData = await statsResponse.json();
                console.log('Stats data:', statsData);
                
                // Test properties endpoint
                const propsResponse = await fetch(`${API_BASE_URL}/api/properties?limit=3`);
                const propsData = await propsResponse.json();
                console.log('Properties data:', propsData);
                
                // Update display with test data
                if (statsData) {
                    document.getElementById('total-records').textContent = statsData.total_properties.toLocaleString();
                }
                
                if (propsData && propsData.data) {
                    displayProperties(propsData.data);
                    updateApiStatus('connected', `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${propsData.data.length} Ø¹Ù‚Ø§Ø± Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±`);
                } else {
                    updateApiStatus('disconnected', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
            } catch (error) {
                updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
                console.error('Test API error:', error);
            }
        }
        
        // Search properties
        async function searchProperties() {
            try {
                updateApiStatus('loading', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...');
                
                const searchQuery = document.getElementById('search-query').value;
                const propertyType = document.getElementById('property-type-filter').value;
                const region = document.getElementById('region-filter').value;
                const sender = document.getElementById('sender-filter').value;
                
                let url = `${API_BASE_URL}/api/properties?limit=${currentLimit}&page=${currentPage}`;
                
                if (searchQuery) url += `&search=${encodeURIComponent(searchQuery)}`;
                if (propertyType) url += `&property_type=${encodeURIComponent(propertyType)}`;
                if (region) url += `&region=${encodeURIComponent(region)}`;
                if (sender) url += `&sender=${encodeURIComponent(sender)}`;
                
                console.log('Searching with URL:', url);
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result && result.data) {
                    currentData = result.data;
                    totalProperties = result.pagination?.total || result.data.length;
                    
                    displayProperties(result.data);
                    updatePaginationInfo(result.data);
                    
                    const total = result.pagination?.total || result.data.length;
                    let infoText = `Ø¹Ø±Ø¶ ${result.data.length} Ù…Ù† Ø£ØµÙ„ ${total} Ù†ØªÙŠØ¬Ø©`;
                    if (searchQuery || propertyType || region || sender) {
                        infoText += ' (Ù…ÙØ±Ø´Ù‘Ø­)';
                    }
                    document.getElementById('results-info').textContent = infoText;
                    
                    updateApiStatus('connected', `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${result.data.length} Ù†ØªÙŠØ¬Ø©`);
                } else {
                    updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«');
                }
            } catch (error) {
                updateApiStatus('disconnected', `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: ${error.message}`);
                console.error('Error searching properties:', error);
            }
        }
        
        // Search by specific keyword
        async function searchByKeyword(keyword) {
            document.getElementById('search-query').value = keyword;
            await searchProperties();
        }
        
        // Display properties in table
        function displayProperties(properties) {
            console.log('Displaying properties:', properties);
            const tbody = document.getElementById('data-table-body');
            
            if (!tbody) {
                console.error('Table body element not found!');
                return;
            }
            
            if (properties.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-12 text-center text-gray-500">
                            <div class="text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>
                            <div class="text-sm mt-2">Ø¬Ø±Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø±Ø´Ø­Ø§Øª Ø§Ù„Ø¨Ø­Ø«</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = properties.map(property => `
                <tr class="table-row">
                    <td class="px-4 py-3 text-sm font-medium text-gray-900 ltr-text">
                        ${property.unique_id || 'N/A'}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-900 rtl-text">
                        <div class="truncate max-w-32" title="${property.sender_name}">
                            ${property.sender_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500">
                        ${property.sender_phone ? `<div class="phone-number mb-1 ltr-text text-xs">
                            <a href="tel:${property.sender_phone}" class="text-blue-600 hover:text-blue-800 hover:underline">
                                ğŸ“± ${property.sender_phone}
                            </a>
                        </div>` : ''}
                        ${property.sender_phone_2 ? `<div class="phone-number ltr-text text-xs">
                            <a href="tel:${property.sender_phone_2}" class="text-blue-600 hover:text-blue-800 hover:underline">
                                ğŸ“ ${property.sender_phone_2}
                            </a>
                        </div>` : ''}
                        ${!property.sender_phone && !property.sender_phone_2 ? 'ØºÙŠØ± Ù…ØªÙˆÙØ±' : ''}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500 rtl-text">
                        <div class="truncate max-w-32" title="${property.region}">
                            ${property.region || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500">
                        ${formatPropertyType(property.property_type)}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-900 rtl-text">
                        <div class="truncate max-w-64" title="${property.message || ''}">
                            ${property.message ? property.message.substring(0, 100) + (property.message.length > 100 ? '...' : '') : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø©'}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500 ltr-text">
                        <div class="text-xs">${property.date || ''}</div>
                        <div class="text-xs text-gray-400">${property.time || ''}</div>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500">
                        <div class="flex space-x-reverse space-x-1">
                            <button onclick="viewPropertyDetails('${property.unique_id}')" 
                                    class="px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                ğŸ‘ï¸
                            </button>
                            <button onclick="editProperty('${property.unique_id}')" 
                                    class="px-2 py-1 bg-yellow-500 text-white rounded text-xs hover:bg-yellow-600" title="ØªØ¹Ø¯ÙŠÙ„">
                                âœï¸
                            </button>
                            <button onclick="deleteProperty('${property.unique_id}')" 
                                    class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600" title="Ø­Ø°Ù">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // Format property type
        function formatPropertyType(type) {
            if (!type) return '<span class="text-gray-400">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>';
            
            const typeMap = {
                'land': { ar: 'Ø£Ø±Ø¶', class: 'property-land' },
                'apartment': { ar: 'Ø´Ù‚Ø©', class: 'property-apartment' },
                'villa': { ar: 'ÙÙŠÙ„Ø§', class: 'property-villa' },
                'commercial': { ar: 'ØªØ¬Ø§Ø±ÙŠ', class: 'property-commercial' }
            };
            
            const typeInfo = typeMap[type] || { ar: type, class: 'status-badge' };
            return `<span class="status-badge ${typeInfo.class}">${typeInfo.ar}</span>`;
        }
        
        // View property details
        async function viewPropertyDetails(uniqueId) {
            try {
                const response = await fetch(`${API_BASE_URL}/property/${uniqueId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    const property = result.data;
                    showPropertyModal(property);
                } else {
                    alert(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±: ${result.message}`);
                }
            } catch (error) {
                alert(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`);
                console.error('Error loading property details:', error);
            }
        }
        
        // Show property modal
        function showPropertyModal(property) {
            const modal = document.getElementById('propertyModal');
            const details = document.getElementById('propertyDetails');
            
            details.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ø§Ù„Ù…Ø¹Ø±Ù:</label>
                        <p class="mt-1 text-sm text-gray-900 ltr-text">${property.unique_id || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                        <p class="mt-1 text-sm text-gray-900 ltr-text">${property.date || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ø§Ù„ÙˆÙ‚Øª:</label>
                        <p class="mt-1 text-sm text-gray-900 ltr-text">${property.time || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ø§Ù„Ù…Ø±Ø³Ù„:</label>
                        <p class="mt-1 text-sm text-gray-900">${property.sender_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                    ${property.sender_phone || property.sender_phone_2 ? `
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ:</label>
                        <div class="space-y-2">
                            ${property.sender_phone ? `
                            <div class="flex items-center space-x-reverse space-x-2 p-2 bg-blue-50 rounded-lg">
                                <span class="text-blue-600">ğŸ“±</span>
                                <span class="text-sm font-medium text-gray-700">Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</span>
                                <a href="tel:${property.sender_phone}" class="text-blue-600 hover:text-blue-800 hover:underline ltr-text font-medium">
                                    ${property.sender_phone}
                                </a>
                                <button onclick="copyToClipboard('${property.sender_phone}')" 
                                        class="px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600" title="Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…">
                                    ğŸ“‹
                                </button>
                            </div>` : ''}
                            ${property.sender_phone_2 ? `
                            <div class="flex items-center space-x-reverse space-x-2 p-2 bg-green-50 rounded-lg">
                                <span class="text-green-600">ğŸ“</span>
                                <span class="text-sm font-medium text-gray-700">Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ:</span>
                                <a href="tel:${property.sender_phone_2}" class="text-green-600 hover:text-green-800 hover:underline ltr-text font-medium">
                                    ${property.sender_phone_2}
                                </a>
                                <button onclick="copyToClipboard('${property.sender_phone_2}')" 
                                        class="px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600" title="Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…">
                                    ğŸ“‹
                                </button>
                            </div>` : ''}
                        </div>
                    </div>` : ''}
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±:</label>
                        <p class="mt-1 text-sm text-gray-900">${property.property_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</label>
                        <p class="mt-1 text-sm text-gray-900">${property.region || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700">Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©:</label>
                    <div class="mt-1 p-3 bg-gray-50 rounded-md text-sm text-gray-900 rtl-text max-h-32 overflow-y-auto">
                        ${property.message || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø©'}
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function closePropertyModal() {
            document.getElementById('propertyModal').style.display = 'none';
        }

        // CRUD Functions

        // Show Add Property Modal
        function showAddPropertyModal() {
            document.getElementById('addEditTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯';
            document.getElementById('propertyForm').reset();
            document.getElementById('propertyId').value = '';
            
            // Set current date and time
            const now = new Date();
            document.getElementById('date').value = now.toISOString().split('T')[0];
            document.getElementById('time').value = now.toTimeString().split(' ')[0].substring(0, 5);
            
            document.getElementById('addEditModal').style.display = 'block';
        }

        // Edit Property
        async function editProperty(uniqueId) {
            try {
                const response = await fetch(`${API_BASE_URL}/property/${uniqueId}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                if (result.status === 'success') {
                    const property = result.data;
                    
                    document.getElementById('addEditTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±';
                    document.getElementById('propertyId').value = property.unique_id;
                    document.getElementById('senderName').value = property.sender_name || '';
                    document.getElementById('region').value = property.region || '';
                    document.getElementById('propertyType').value = property.property_type || '';
                    document.getElementById('message').value = property.message || '';
                    document.getElementById('date').value = property.date || '';
                    document.getElementById('time').value = property.time || '';
                    
                    document.getElementById('addEditModal').style.display = 'block';
                } else {
                    alert(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±: ${result.message}`);
                }
            } catch (error) {
                alert(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`);
                console.error('Error loading property for edit:', error);
            }
        }

        // Delete Property
        async function deleteProperty(uniqueId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/property/${uniqueId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                if (result.status === 'success') {
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
                    loadAllProperties(); // Refresh the list
                    loadStats(); // Refresh stats
                } else {
                    alert(`Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø±: ${result.message}`);
                }
            } catch (error) {
                alert(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`);
                console.error('Error deleting property:', error);
            }
        }

        // Remove Duplicates
        async function removeDuplicates() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©ØŸ Ø³ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø£ÙˆÙ„ Ø¹Ù‚Ø§Ø± Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© Ù…ÙƒØ±Ø±Ø©.')) {
                return;
            }
            
            try {
                updateApiStatus('loading', 'Ø¬Ø§Ø±ÙŠ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±...');
                
                const response = await fetch(`${API_BASE_URL}/api/remove-duplicates`, {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                if (result.status === 'success') {
                    alert(`ØªÙ… Ø¥Ø²Ø§Ù„Ø© ${result.total_removed} Ø¹Ù‚Ø§Ø± Ù…ÙƒØ±Ø± Ù…Ù† Ø£ØµÙ„ ${result.duplicates_found} Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ÙƒØ±Ø±Ø©`);
                    loadAllProperties(); // Refresh the list
                    loadStats(); // Refresh stats
                    updateApiStatus('connected', 'ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø± Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    alert(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±: ${result.message}`);
                    updateApiStatus('disconnected', 'ÙØ´Ù„ ÙÙŠ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±');
                }
            } catch (error) {
                alert(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`);
                updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±');
                console.error('Error removing duplicates:', error);
            }
        }

        // Close Add/Edit Modal
        function closeAddEditModal() {
            document.getElementById('addEditModal').style.display = 'none';
        }
        
        // Load top regions
        async function loadTopRegions() {
            try {
                updateApiStatus('loading', 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ù‡Ù… Ø§Ù„Ù…Ù†Ø§Ø·Ù‚...');
                const response = await fetch(`${API_BASE_URL}/api/regions?limit=20`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                // API returns {status: 'success', data: [...]} format
                if (result.status === 'success' && result.data) {
                    showDataModal('Ø£Ù‡Ù… 20 Ù…Ù†Ø·Ù‚Ø©', result.data.map(item => 
                        `<tr><td class="px-4 py-2 border-b">${item.region}</td><td class="px-4 py-2 border-b ltr-text">${item.count.toLocaleString()}</td></tr>`
                    ).join(''), ['Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª']);
                    updateApiStatus('connected', `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${result.data.length} Ù…Ù†Ø·Ù‚Ø©`);
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚');
                alert(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚: ${error.message}`);
                console.error('Error loading regions:', error);
            }
        }
        
        // Load top senders
        async function loadTopSenders() {
            try {
                updateApiStatus('loading', 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø±Ø³Ù„ÙŠÙ† Ù†Ø´Ø§Ø·Ø§Ù‹...');
                const response = await fetch(`${API_BASE_URL}/api/senders?limit=15`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                // API returns {status: 'success', data: [...]} format
                if (result.status === 'success' && result.data) {
                    showDataModal('Ø£ÙƒØ«Ø± 15 Ù…Ø±Ø³Ù„ Ù†Ø´Ø§Ø·Ø§Ù‹', result.data.map(item => 
                        `<tr><td class="px-4 py-2 border-b">${item.sender_name}</td><td class="px-4 py-2 border-b ltr-text">${item.count.toLocaleString()}</td></tr>`
                    ).join(''), ['Ø§Ù„Ù…Ø±Ø³Ù„', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„']);
                    updateApiStatus('connected', `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${result.data.length} Ù…Ø±Ø³Ù„`);
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±Ø³Ù„ÙŠÙ†');
                alert(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±Ø³Ù„ÙŠÙ†: ${error.message}`);
                console.error('Error loading senders:', error);
            }
        }
        
        // Load property types
        async function loadPropertyTypes() {
            try {
                updateApiStatus('loading', 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª...');
                const response = await fetch(`${API_BASE_URL}/api/property-types`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                // API returns array directly [{property_type, count}]
                if (Array.isArray(result) && result.length > 0) {
                    // Calculate percentages
                    const total = result.reduce((sum, item) => sum + item.count, 0);
                    const dataWithPercentages = result.map(item => ({
                        ...item,
                        percentage: ((item.count / total) * 100).toFixed(1)
                    }));
                    
                    showDataModal('ØªÙˆØ²ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª', dataWithPercentages.map(item => 
                        `<tr><td class="px-4 py-2 border-b">${formatPropertyType(item.property_type)}</td><td class="px-4 py-2 border-b ltr-text">${item.count.toLocaleString()}</td><td class="px-4 py-2 border-b ltr-text">${item.percentage}%</td></tr>`
                    ).join(''), ['Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±', 'Ø§Ù„Ø¹Ø¯Ø¯', 'Ø§Ù„Ù†Ø³Ø¨Ø©']);
                    updateApiStatus('connected', `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${result.length} Ù†ÙˆØ¹ Ø¹Ù‚Ø§Ø±`);
                } else {
                    throw new Error('No property types found');
                }
            } catch (error) {
                updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª');
                alert(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª: ${error.message}`);
                console.error('Error loading property types:', error);
            }
        }
        
        // Show data modal
        function showDataModal(title, rows, headers) {
            const modal = document.getElementById('propertyModal');
            const details = document.getElementById('propertyDetails');
            
            details.innerHTML = `
                <h3 class="text-lg font-semibold mb-4">${title}</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                ${headers.map(header => `<th class="px-4 py-2 border-b text-right font-medium">${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${rows}
                        </tbody>
                    </table>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        // Update pagination info
        function updatePaginationInfo(pagination) {
            const info = document.getElementById('pagination-info');
            info.textContent = `Ø¹Ø±Ø¶ ${pagination.offset + 1} - ${pagination.offset + currentData.length} Ù…Ù† ${pagination.total.toLocaleString()} Ø¹Ù‚Ø§Ø±`;
            
            document.getElementById('prev-btn').disabled = pagination.offset === 0;
            document.getElementById('next-btn').disabled = !pagination.has_more;
        }
        
        // Update results info
        function updateResultsInfo(pagination) {
            const info = document.getElementById('results-info');
            if (pagination && pagination.total !== undefined) {
                info.textContent = `Ø¹Ø±Ø¶ ${currentData.length} Ù…Ù† Ø£ØµÙ„ ${pagination.total.toLocaleString()} Ø¹Ù‚Ø§Ø±`;
            } else {
                info.textContent = `Ø¹Ø±Ø¶ ${currentData.length} Ù†ØªÙŠØ¬Ø©`;
            }
            
            // Update pagination buttons if they exist
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (prevBtn && nextBtn && pagination) {
                prevBtn.disabled = pagination.page <= 1;
                nextBtn.disabled = !pagination.has_more;
            }
        }
        
        // Pagination functions
        function nextPage() {
            if (hasMore) {
                currentOffset += currentLimit;
                loadAllProperties();
            }
        }
        
        function previousPage() {
            if (currentOffset > 0) {
                currentOffset = Math.max(0, currentOffset - currentLimit);
                loadAllProperties();
            }
        }
        
        // Clear all filters
        function clearAllFilters() {
            document.getElementById('search-query').value = '';
            document.getElementById('property-type-filter').value = '';
            document.getElementById('region-filter').value = '';
            document.getElementById('sender-filter').value = '';
            currentOffset = 0;
            searchProperties();
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            checkApiConnection();
            
            // Property Form Submission
            document.getElementById('propertyForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const propertyData = Object.fromEntries(formData.entries());
                const isEdit = !!document.getElementById('propertyId').value;
                
                try {
                    updateApiStatus('loading', isEdit ? 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù‚Ø§Ø±...' : 'Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø±...');
                    
                    const url = isEdit 
                        ? `${API_BASE_URL}/property/${propertyData.unique_id}`
                        : `${API_BASE_URL}/api/property`;
                    
                    const method = isEdit ? 'PUT' : 'POST';
                    
                    const response = await fetch(url, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(propertyData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    if (result.status === 'success') {
                        alert(isEdit ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
                        closeAddEditModal();
                        loadAllProperties(); // Refresh the list
                        loadStats(); // Refresh stats
                        updateApiStatus('connected', isEdit ? 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­');
                    } else {
                        alert(`Ø®Ø·Ø£: ${result.message}`);
                        updateApiStatus('disconnected', isEdit ? 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«' : 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
                    }
                } catch (error) {
                    alert(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`);
                    updateApiStatus('disconnected', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
                    console.error('Error saving property:', error);
                }
            });
            
            // Enter key for search
            document.getElementById('search-query').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchProperties();
                }
            });
            
            // Filter changes to trigger search
            ['property-type-filter', 'region-filter', 'sender-filter'].forEach(id => {
                document.getElementById(id).addEventListener('change', function() {
                    currentPage = 1; // Reset to first page when filtering
                    searchProperties();
                });
            });
            
            // Search input also resets to page 1
            document.getElementById('search-query').addEventListener('input', function() {
                currentPage = 1; // Reset to first page when searching
            });
            
            // Limit change
            document.getElementById('limit-select').addEventListener('change', function() {
                currentLimit = parseInt(this.value);
                currentPage = 1; // Reset to first page when changing page size
                searchProperties();
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                const propertyModal = document.getElementById('propertyModal');
                const addEditModal = document.getElementById('addEditModal');
                
                if (e.target === propertyModal) {
                    closePropertyModal();
                }
                if (e.target === addEditModal) {
                    closeAddEditModal();
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('search-query').focus();
                }
                if (e.key === 'Escape') {
                    closePropertyModal();
                }
            });
        });

        // Copy to clipboard function
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                // Use the Clipboard API
                navigator.clipboard.writeText(text).then(() => {
                    showToast(`ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…: ${text}`);
                }).catch(err => {
                    console.error('Failed to copy using Clipboard API:', err);
                    fallbackCopy(text);
                });
            } else {
                // Fallback for older browsers or non-secure contexts
                fallbackCopy(text);
            }
        }

        // Fallback copy method
        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast(`ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…: ${text}`);
                } else {
                    showToast('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…');
                }
            } catch (err) {
                console.error('Fallback copy failed:', err);
                showToast('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…');
            }
            
            document.body.removeChild(textArea);
        }

        // Show toast notification
        function showToast(message) {
            // Remove existing toast if any
            const existingToast = document.getElementById('toast');
            if (existingToast) {
                existingToast.remove();
            }

            // Create toast element
            const toast = document.createElement('div');
            toast.id = 'toast';
            toast.className = 'fixed top-20 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-opacity duration-300';
            toast.textContent = message;

            // Add to page
            document.body.appendChild(toast);

            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Pagination variables
        let currentPage = 1;
        // currentLimit is already declared above
        let totalProperties = 0;

        // Pagination functions
        function firstPage() {
            if (currentPage > 1) {
                currentPage = 1;
                searchProperties();
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                searchProperties();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(totalProperties / currentLimit);
            if (currentPage < totalPages) {
                currentPage++;
                searchProperties();
            }
        }

        function lastPage() {
            const totalPages = Math.ceil(totalProperties / currentLimit);
            if (currentPage < totalPages) {
                currentPage = totalPages;
                searchProperties();
            }
        }

        function changePageSize() {
            const newLimit = parseInt(document.getElementById('page-size').value);
            currentLimit = newLimit;
            currentPage = 1; // Reset to first page when changing page size
            searchProperties();
        }

        function updatePaginationInfo(data) {
            const totalPages = Math.ceil(totalProperties / currentLimit);
            const startIndex = (currentPage - 1) * currentLimit + 1;
            const endIndex = Math.min(currentPage * currentLimit, totalProperties);

            // Update pagination info text
            document.getElementById('pagination-info').textContent = 
                `Ø¹Ø±Ø¶ ${startIndex} Ø¥Ù„Ù‰ ${endIndex} Ù…Ù† ${totalProperties} Ù†ØªÙŠØ¬Ø©`;

            // Update page numbers
            document.getElementById('page-numbers').textContent = 
                `ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}`;

            // Update button states
            const firstBtn = document.getElementById('first-btn');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const lastBtn = document.getElementById('last-btn');

            if (firstBtn) {
                firstBtn.disabled = currentPage <= 1;
                firstBtn.style.opacity = currentPage <= 1 ? '0.5' : '1';
            }

            if (prevBtn) {
                prevBtn.disabled = currentPage <= 1;
                prevBtn.style.opacity = currentPage <= 1 ? '0.5' : '1';
            }

            if (nextBtn) {
                nextBtn.disabled = currentPage >= totalPages;
                nextBtn.style.opacity = currentPage >= totalPages ? '0.5' : '1';
            }

            if (lastBtn) {
                lastBtn.disabled = currentPage >= totalPages;
                lastBtn.style.opacity = currentPage >= totalPages ? '0.5' : '1';
            }
        }
    </script>
</body>
</html>
